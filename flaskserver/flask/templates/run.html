{% extends "base.html" %}
{% block head %}
<!--  
    Handle the running of one script.  Passed parameters are:
        pid = the identifier of the running process
        scriptname = the name of the file that was run
-->
<title>{{scriptname}} - Output</title>
{% endblock head %}

{% block body %}

<h2>Output from: {{scriptname}}</h2>

<!-- TODO: Set up size and styling on the frame --> 
<iframe id='output_frame' src='/output/{{pid}}' onload='check_reload()'></iframe> 

<h3>Is script still running? - ???</h3>


<script>
function check_reload() {
    // Wait for a specified time then reload the output iframe
    TIME_OUT_MILLIS = 1000
    window.setTimeout("load_output()", TIME_OUT_MILLIS)
}

function load_output() {
    // Update the output in the iframe
    if (is_process_running()) {
        document.getElementById('output_frame').contentWindow.location.reload();
        //TODO:  Move the frame to the last line
    }
}

function is_process_running() {
    //Query the server to ask if the pid this page is looking at is still running
    // Not going to try to support IE6 or earlier
    // TODO:  Change to xmlhttp to load the output and handle the race condition for the last output
    
    xmlhttp=new XMLHttpRequest();
    xmlhttp.open("GET", "/isrunning/{{pid}}", false); //false = synchronous request
    xmlhttp.send();
    return (xmlhttp.responseText == 'yes')
}


</script>
{% endblock body %}